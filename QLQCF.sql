CREATE DATABASE QuanLyQuanCafe
GO
USE QuanLyQuanCafe
GO
CREATE TABLE TABLECOFFEE
(
	IDTABLE INT PRIMARY KEY,
	NAME NVARCHAR(100) NOT NULL,
	STATUS NVARCHAR(100) NOT NULL 
)
CREATE TABLE COFFEETYPE 
(
	IDTYPE INT PRIMARY KEY,
	NAME NVARCHAR(100) NOT NULL,
	NSX DATE,
	ORIGIN NVARCHAR(100) 
)
CREATE TABLE MENU 
(
	IDMENU INT PRIMARY KEY,
	NAME NVARCHAR(100) NOT NULL,
	IDTYPE INT NOT NULL, 
	PRICE FLOAT NOT NULL DEFAULT 0,
	IDDIS INT ,
	FOREIGN KEY (IDTYPE) REFERENCES COFFEETYPE(IDTYPE),
	FOREIGN KEY (IDDIS) REFERENCES DISCOUNT(IDDIS) ,
	AVATARMENU NVARCHAR(100)
)
CREATE TABLE BILL
(
	IDBILL INT PRIMARY KEY,
	IDTABLE INT NOT NULL, 
	dateCheckIn DATE,
	dateCheckOut DATE,
	STATUS INT,
	FOREIGN KEY (IDTABLE) REFERENCES TABLECOFFEE(IDTABLE) 
)
CREATE TABLE BILLINFO
(
	IDINFO INT PRIMARY KEY,
	IDBILL INT NOT NULL, 
	IDMENU INT NOT NULL, 
	COUNT FLOAT NOT NULL DEFAULT 0, 
	FOREIGN KEY (IDBILL) REFERENCES BILL(IDBILL),
	FOREIGN KEY (IDMENU) REFERENCES MENU(IDMENU)

)
CREATE TABLE INVENTORY
(
    IDINVENTORY INT PRIMARY KEY,
    IDTYPE INT NOT NULL, 
    QUANTITY FLOAT NOT NULL,
	DATE_RECEIVED DATE,
	DATE_EXPIRED DATE,
	FOREIGN KEY (IDTYPE) REFERENCES COFFEETYPE(IDTYPE) 
)
CREATE TABLE ACCOUNT 
(
	USERNAME NVARCHAR(100) PRIMARY KEY,
	PASSWORD NVARCHAR(100) NOT NULL,
	IDEMPLOYEE INT,
	IDTYPETK INT,
	FOREIGN KEY (IDEMPLOYEE) REFERENCES EMPLOYEE(IDEMPLOYEE),
	FOREIGN KEY (IDTYPETK) REFERENCES TYPEACCOUNT(IDTYPETK)
);
CREATE TABLE DISCOUNT 
(
	IDDIS INT PRIMARY KEY,
	NAME NVARCHAR(100) NOT NULL,
	DISCOUNT_PERCENTAGE FLOAT NOT NULL, 
	DATE_START DATE,
	DATE_FINISH DATE,
)
CREATE TABLE EMPLOYEE
(
	IDEMPLOYEE INT PRIMARY KEY,
	NAME NVARCHAR(100),
	POSITION NVARCHAR(100),
	SALARY FLOAT ,
	DATE_HIRE DATE,
	AVATAREMPLOYEE NVARCHAR(100)
)
CREATE TABLE TYPEACCOUNT
(
	IDTYPETK INT PRIMARY KEY,
	NAME NVARCHAR(100) NOT NULL
)

INSERT INTO TABLECOFFEE(IDTABLE,NAME,STATUS) VALUES
(1,N'Bàn 1',N'KHÔNG CÓ KHÁCH'),
(2,N'Bàn 2',N'CÓ KHÁCH'),
(3,N'Bàn 3',N'CÓ KHÁCH'),
(4,N'Bàn 4',N'KHÔNG CÓ KHÁCH');
 INSERT INTO COFFEETYPE(IDTYPE,NAME,NSX,ORIGIN) VALUES
(01,N'CULI','2008-12-03','TL'),
(02,N'CHERRY','2002-01-01','VN'),
(03,N'MOKA','2006-11-21','VN'),
(04,N'ARABICA','1992-06-01','TL'),
(05,N'ROBUSTA','2011-05-30','VN'),
(06,N'CHERRY','1999-10-09','TL');
 
INSERT INTO MENU(IDMENU,NAME,IDTYPE,PRICE,IDDIS, AVATARMENU) VALUES
(1,N'Cà phê đá',01,20000,1,null),
(2,N'Cà phê sữa đá',02,15000,2, null),
(3,N'Bạc xỉu',01,20000,3,null),
(4,N'Expresso',04,30000,1,null),
(5,N'Cappuchino',05,35000,2,null),
(6,N'Americano',06,40000,2,null),
(7,N'Caramel Macchiato',04,50000,3,null),
(8,N'Cà phê trứng',03,45000,1,null);

INSERT INTO BILL(IDBILL,IDTABLE,dateCheckIn,dateCheckOut,STATUS) VALUES
(1, 2, '2024-10-21', '2024-10-21', 1),
(2, 1, '2024-05-05', NULL, 0),
(3, 3, '2024-05-07', '2024-05-07', 1),
(4, 4, '2024-05-10', NULL, 0);

INSERT INTO BILLINFO(IDINFO, IDBILL, IDMENU, COUNT) VALUES
(1, 1, 1, 2),  
(2, 1, 2, 1),
(3, 2, 3, 3),
(4, 3, 4, 4);
INSERT INTO INVENTORY(IDINVENTORY,IDTYPE,QUANTITY,DATE_RECEIVED,DATE_EXPIRED) VALUES
(1,1,10,'2023-10-11','2024-10-11'),
(2,2,12,'2023-12-01','2024-10-21'),
(3,3,20,'2022-09-10','2023-04-10'),
(4,4,18,'2020-01-02','2022-09-07');

INSERT INTO ACCOUNT(USERNAME,PASSWORD, IDEMPLOYEE, IDTYPETK) VALUES
('Admin', 'Admin123', NULL, 1),
('User1', 'User111', 2, 0),
('User2', 'User111', 3, 0)



INSERT INTO DISCOUNT(IDDIS,NAME,DISCOUNT_PERCENTAGE,DATE_START,DATE_FINISH) VALUES
(1,N'Khuyến mãi Tết',20,'2023-12-05','2024-01-15'),
(2,N'Khuyến mãi Hè',15,'2024-01-05','2024-06-30'),
(3,N'Khuyến mãi Giáng Sinh',25,'2023-12-23','2024-12-26');

INSERT INTO EMPLOYEE(IDEMPLOYEE, NAME, POSITION, SALARY, DATE_HIRE, AVATAREMPLOYEE) VALUES
(1, N'Nguyễn Hoàng Anh', N'Phục vụ', 5000000, '2022-01-10',null ),
(2, N'lê Trần Kim Hưng', N'Thu ngân', 6000000, '2022-03-15',null),
(3, N'Lê Minh Khuê', N'Quản lý', 10000000, '2021-05-05',null),
(4, N'Phạm Thị Tuyết Mai', N'Pha chế', 7000000, '2023-02-20',null)
INSERT INTO TYPEACCOUNT(IDTYPETK,NAME) VALUES
(1, N'Admin'),
(0, N'User')

CREATE VIEW QLCF AS
SELECT B.IDBILL, B.IDTABLE, M.NAME, M.PRICE, BF.COUNT,B.dateCheckIn,B.dateCheckOut
FROM BILL B 
JOIN BILLINFO BF ON B.IDBILL = BF.IDBILL
JOIN MENU M ON M.IDMENU = BF.IDMENU
JOIN DISCOUNT D ON M.IDDIS = D.IDDIS